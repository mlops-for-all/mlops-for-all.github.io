"use strict";(self.webpackChunkv_2=self.webpackChunkv_2||[]).push([[3222],{3905:(e,a,t)=>{t.d(a,{Zo:()=>c,kt:()=>g});var n=t(7294);function l(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function r(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?r(Object(t),!0).forEach((function(a){l(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function s(e,a){if(null==e)return{};var t,n,l=function(e,a){if(null==e)return{};var t,n,l={},r=Object.keys(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||(l[t]=e[t]);return l}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var i=n.createContext({}),p=function(e){var a=n.useContext(i),t=a;return e&&(t="function"==typeof e?e(a):o(o({},a),e)),t},c=function(e){var a=p(e.components);return n.createElement(i.Provider,{value:a},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},m=n.forwardRef((function(e,a){var t=e.components,l=e.mdxType,r=e.originalType,i=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(t),m=l,g=d["".concat(i,".").concat(m)]||d[m]||u[m]||r;return t?n.createElement(g,o(o({ref:a},c),{},{components:t})):n.createElement(g,o({ref:a},c))}));function g(e,a){var t=arguments,l=a&&a.mdxType;if("string"==typeof e||l){var r=t.length,o=new Array(r);o[0]=m;var s={};for(var i in a)hasOwnProperty.call(a,i)&&(s[i]=a[i]);s.originalType=e,s[d]="string"==typeof e?e:l,o[1]=s;for(var p=2;p<r;p++)o[p]=t[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,t)}m.displayName="MDXCreateElement"},3770:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>i,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var n=t(7462),l=(t(7294),t(3905));const r={title:"2. Install load balancer metallb for Bare Metal Cluster",sidebar_position:2},o=void 0,s={unversionedId:"appendix/metallb",id:"appendix/metallb",title:"2. Install load balancer metallb for Bare Metal Cluster",description:"What is MetalLB?",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/appendix/metallb.md",sourceDirName:"appendix",slug:"/appendix/metallb",permalink:"/en/docs/appendix/metallb",draft:!1,editUrl:"https://github.com/mlops-for-all/mlops-for-all.github.io/tree/main/docs/appendix/metallb.md",tags:[],version:"current",lastUpdatedBy:"Aiden-Jeon",lastUpdatedAt:1706783082,formattedLastUpdatedAt:"Feb 1, 2024",sidebarPosition:2,frontMatter:{title:"2. Install load balancer metallb for Bare Metal Cluster",sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"1. Install Python virtual environment",permalink:"/en/docs/appendix/pyenv"},next:{title:"Further Readings",permalink:"/en/docs/further-readings/info"}},i={},p=[{value:"What is MetalLB?",id:"what-is-metallb",level:2},{value:"Installing MetalLB",id:"installing-metallb",level:2},{value:"Requirements",id:"requirements",level:2},{value:"MetalLB Installation",id:"metallb-installation",level:3},{value:"Preparation",id:"preparation",level:4},{value:"Installation - Manifest",id:"installation---manifest",level:3},{value:"1. Install MetalLB.",id:"1-install-metallb",level:4},{value:"2. Check installation.",id:"2-check-installation",level:4},{value:"Configuration",id:"configuration",level:2},{value:"Layer 2 Configuration",id:"layer-2-configuration",level:3},{value:"metallb_config.yaml",id:"metallb_configyaml",level:4},{value:"Using MetalLB",id:"using-metallb",level:2},{value:"Kubeflow Dashboard",id:"kubeflow-dashboard",level:3},{value:"minio Dashboard",id:"minio-dashboard",level:3},{value:"mlflow Dashboard",id:"mlflow-dashboard",level:3},{value:"Grafana Dashboard",id:"grafana-dashboard",level:3}],c={toc:p},d="wrapper";function u(e){let{components:a,...r}=e;return(0,l.kt)(d,(0,n.Z)({},c,r,{components:a,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"what-is-metallb"},"What is MetalLB?"),(0,l.kt)("h2",{id:"installing-metallb"},"Installing MetalLB"),(0,l.kt)("p",null,"When using Kubernetes on cloud platforms such as AWS, GCP, and Azure, they provide their own load balancers. However, for on-premises clusters, an additional module needs to be installed to enable load balancing. ",(0,l.kt)("a",{parentName:"p",href:"https://metallb.universe.tf/"},"MetalLB")," is an open-source project that provides a load balancer for bare metal environments."),(0,l.kt)("h2",{id:"requirements"},"Requirements"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Requirement"),(0,l.kt)("th",{parentName:"tr",align:null},"Version and Details"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"Kubernetes"),(0,l.kt)("td",{parentName:"tr",align:null},"Version >= v1.13.0 without built-in load balancing")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{parentName:"td",href:"https://metallb.universe.tf/installation/network-addons/"},"Compatible Network CNI")),(0,l.kt)("td",{parentName:"tr",align:null},"Calico, Canal, Cilium, Flannel, Kube-ovn, Kube-router, Weave Net")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"IPv4 addresses"),(0,l.kt)("td",{parentName:"tr",align:null},"Used for MetalLB deployment")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"BGP mode"),(0,l.kt)("td",{parentName:"tr",align:null},"One or more routers that support BGP functionality")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"TCP/UDP port 7946 open between nodes"),(0,l.kt)("td",{parentName:"tr",align:null},"Memberlist requirement")))),(0,l.kt)("h3",{id:"metallb-installation"},"MetalLB Installation"),(0,l.kt)("h4",{id:"preparation"},"Preparation"),(0,l.kt)("p",null,"If you are using kube-proxy in IPVS mode, starting from Kubernetes v1.14.2, you need to enable strict ARP mode.",(0,l.kt)("br",{parentName:"p"}),"\n","By default, Kube-router enables strict ARP, so this feature is not required if you are using Kube-router as a service proxy.",(0,l.kt)("br",{parentName:"p"}),"\n","Before applying strict ARP mode, check the current mode."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"# see what changes would be made, returns nonzero returncode if different\nkubectl get configmap kube-proxy -n kube-system -o yaml | \\\ngrep strictARP\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"strictARP: false\n")),(0,l.kt)("p",null,"If strictARP: false is outputted, run the following to change it to strictARP: true.\n(If strictARP: true is already outputted, you do not need to execute the following command)."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'# actually apply the changes, returns nonzero returncode on errors only\nkubectl get configmap kube-proxy -n kube-system -o yaml | \\\nsed -e "s/strictARP: false/strictARP: true/" | \\\nkubectl apply -f - -n kube-system\n')),(0,l.kt)("p",null,"If performed normally, it will be output as follows."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"Warning: resource configmaps/kube-proxy is missing the kubectl.kubernetes.io/last-applied-configuration annotation which is required by kubectl apply. kubectl apply should only be used on resources created declaratively by either kubectl create --save-config or kubectl apply. The missing annotation will be patched automatically.\nconfigmap/kube-proxy configured\n")),(0,l.kt)("h3",{id:"installation---manifest"},"Installation - Manifest"),(0,l.kt)("h4",{id:"1-install-metallb"},"1. Install MetalLB."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.11.0/manifests/namespace.yaml\nkubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.11.0/manifests/metallb.yaml\n")),(0,l.kt)("h4",{id:"2-check-installation"},"2. Check installation."),(0,l.kt)("p",null,"Wait until both pods in the metallb-system namespace are Running."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get pod -n metallb-system\n")),(0,l.kt)("p",null,"When everthing is Running, similar results will be output."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"NAME                          READY   STATUS    RESTARTS   AGE\ncontroller-7dcc8764f4-8n92q   1/1     Running   1          1m\nspeaker-fnf8l                 1/1     Running   1          1m\n")),(0,l.kt)("p",null,"The components of the manifest are as follows:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"metallb-system/controller",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Deployed as a deployment, responsible for assigning external IP addresses for load balancing."))),(0,l.kt)("li",{parentName:"ul"},"metallb-system/speaker",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Deployed as a daemonset, responsible for configuring network communication to connect external traffic and services.")))),(0,l.kt)("p",null,"The service includes RBAC permissions which are necessary for the controller and speaker components to operate."),(0,l.kt)("h2",{id:"configuration"},"Configuration"),(0,l.kt)("p",null,"Setting up the load balancing policy of MetalLB can be done by deploying a configmap containing the related configuration information."),(0,l.kt)("p",null,"There are two modes that can be configured in MetalLB:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("a",{parentName:"li",href:"https://metallb.universe.tf/concepts/layer2/"},"Layer 2 Mode")," "),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("a",{parentName:"li",href:"https://metallb.universe.tf/concepts/bgp/"},"BGP Mode")," ")),(0,l.kt)("p",null,"Here we will proceed with Layer 2 mode."),(0,l.kt)("h3",{id:"layer-2-configuration"},"Layer 2 Configuration"),(0,l.kt)("p",null,"In the Layer 2 mode, it is enough to set only the range of IP addresses to be used simply.",(0,l.kt)("br",{parentName:"p"}),"\n","When using Layer 2 mode, it is not necessary to bind IP to the network interface of the worker node, because it operates in a way that it responds directly to the ARP request of the local network and provides the computer's MAC address to the client."),(0,l.kt)("p",null,"The following ",(0,l.kt)("inlineCode",{parentName:"p"},"metallb_config.yaml")," file is the configuration for MetalLB to provide control over the IP range of 192.168.35.100 ~ 192.168.35.110, and to configure Layer 2 mode."),(0,l.kt)("p",null,"In case the cluster node and the client node are separated, the range of 192.168.35.100 ~ 192.168.35.110 must be accessible by both the client node and the cluster node."),(0,l.kt)("h4",{id:"metallb_configyaml"},"metallb_config.yaml"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"apiVersion: v1\nkind: ConfigMap\nmetadata:\n  namespace: metallb-system\n  name: config\ndata:\n  config: |\n    address-pools:\n    - name: default\n      protocol: layer2\n      addresses:\n      - 192.168.35.100-192.168.35.110  # IP \ub300\uc5ed\ud3ed\n")),(0,l.kt)("p",null,"Apply the above settings."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-test"},"kubectl apply -f metallb_config.yaml \n")),(0,l.kt)("p",null,"If deployed normally, it will output as follows."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-test"},"configmap/config created\n")),(0,l.kt)("h2",{id:"using-metallb"},"Using MetalLB"),(0,l.kt)("h3",{id:"kubeflow-dashboard"},"Kubeflow Dashboard"),(0,l.kt)("p",null,"First, before getting the load-balancing feature from MetalLB, check the current status by changing the type of the istio-ingressgateway service in the istio-system namespace to ",(0,l.kt)("inlineCode",{parentName:"p"},"LoadBalancer")," to provide the Kubeflow Dashboard."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get svc/istio-ingressgateway -n istio-system\n")),(0,l.kt)("p",null,"The type of this service is ClusterIP and you can see that the External-IP value is ",(0,l.kt)("inlineCode",{parentName:"p"},"none"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"NAME                   TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)                                        AGE\nistio-ingressgateway   ClusterIP   10.103.72.5   <none>        15021/TCP,80/TCP,443/TCP,31400/TCP,15443/TCP   4h21m\n")),(0,l.kt)("p",null,"Change the type to LoadBalancer and if you want to input a desired IP address, add the loadBalancerIP item.",(0,l.kt)("br",{parentName:"p"}),"\n","If you do not add it, IP addresses will be assigned sequentially from the IP address pool set above."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl edit svc/istio-ingressgateway -n istio-system\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"spec:\n  clusterIP: 10.103.72.5\n  clusterIPs:\n  - 10.103.72.5\n  ipFamilies:\n  - IPv4\n  ipFamilyPolicy: SingleStack\n  ports:\n  - name: status-port\n    port: 15021\n    protocol: TCP\n    targetPort: 15021\n  - name: http2\n    port: 80\n    protocol: TCP\n    targetPort: 8080\n  - name: https\n    port: 443\n    protocol: TCP\n    targetPort: 8443\n  - name: tcp\n    port: 31400\n    protocol: TCP\n    targetPort: 31400\n  - name: tls\n    port: 15443\n    protocol: TCP\n    targetPort: 15443\n  selector:\n    app: istio-ingressgateway\n    istio: ingressgateway\n  sessionAffinity: None\n  type: LoadBalancer # Change ClusterIP to LoadBalancer\n  loadBalancerIP: 192.168.35.100   # Add IP\nstatus:\n  loadBalancer: {}\n")),(0,l.kt)("p",null,"If you check again, you will see that the External-IP value is ",(0,l.kt)("inlineCode",{parentName:"p"},"192.168.35.100"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get svc/istio-ingressgateway -n istio-system\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"NAME                   TYPE           CLUSTER-IP    EXTERNAL-IP      PORT(S)                                                                      AGE\nistio-ingressgateway   LoadBalancer   10.103.72.5   192.168.35.100   15021:31054/TCP,80:30853/TCP,443:30443/TCP,31400:30012/TCP,15443:31650/TCP   5h1m\n")),(0,l.kt)("p",null,"Open a web browser and connect to ",(0,l.kt)("a",{parentName:"p",href:"http://192.168.35.100"},"http://192.168.35.100")," to verify the following screen is output."),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"login-after-istio-ingressgateway-setting.png",src:t(4232).Z,width:"1811",height:"1046"})),(0,l.kt)("h3",{id:"minio-dashboard"},"minio Dashboard"),(0,l.kt)("p",null,"First, we check the current status before changing the type of minio-service, which provides the Dashboard of minio, in the kubeflow namespace to LoadBalancer to receive the load balancing function from MetalLB."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get svc/minio-service -n kubeflow\n")),(0,l.kt)("p",null,"The type of this service is ClusterIP and you can confirm that the External-IP value is ",(0,l.kt)("inlineCode",{parentName:"p"},"none"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"NAME            TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE\nminio-service   ClusterIP   10.109.209.87   <none>        9000/TCP   5h14m\n")),(0,l.kt)("p",null,"Change the type to LoadBalancer and if you want to enter an IP address, add the loadBalancerIP item. If you do not add, the IP address will be assigned sequentially from the IP address pool set above."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl edit svc/minio-service -n kubeflow\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'apiVersion: v1\nkind: Service\nmetadata:\n  annotations:\n    kubectl.kubernetes.io/last-applied-configuration: |\n      {"apiVersion":"v1","kind":"Service","metadata":{"annotations":{},"labels":{"application-crd-id":"kubeflow-pipelines"},"name":"minio-ser>\n  creationTimestamp: "2022-01-05T08:44:23Z"\n  labels:\n    application-crd-id: kubeflow-pipelines\n  name: minio-service\n  namespace: kubeflow\n  resourceVersion: "21120"\n  uid: 0053ee28-4f87-47bb-ad6b-7ad68aa29a48\nspec:\n  clusterIP: 10.109.209.87\n  clusterIPs:\n  - 10.109.209.87\n  ipFamilies:\n  - IPv4\n  ipFamilyPolicy: SingleStack\n  ports:\n  - name: http\n    port: 9000\n    protocol: TCP\n    targetPort: 9000\n  selector:\n    app: minio\n    application-crd-id: kubeflow-pipelines\n  sessionAffinity: None\n  type: LoadBalancer # Change ClusterIP to LoadBalancer\n  loadBalancerIP: 192.168.35.101 # Add IP\nstatus:\n  loadBalancer: {}\n')),(0,l.kt)("p",null,"If we check again, we can see that the External-IP value is ",(0,l.kt)("inlineCode",{parentName:"p"},"192.168.35.101"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get svc/minio-service -n kubeflow\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"NAME            TYPE           CLUSTER-IP      EXTERNAL-IP      PORT(S)          AGE\nminio-service   LoadBalancer   10.109.209.87   192.168.35.101   9000:31371/TCP   5h21m\n")),(0,l.kt)("p",null,"Open a web browser and connect to ",(0,l.kt)("a",{parentName:"p",href:"http://192.168.35.101:9000"},"http://192.168.35.101:9000")," to confirm the following screen is printed. "),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"login-after-minio-setting.png",src:t(9706).Z,width:"1811",height:"1046"})),(0,l.kt)("h3",{id:"mlflow-dashboard"},"mlflow Dashboard"),(0,l.kt)("p",null,"First, we check the current status before changing the type of mlflow-server-service service in the mlflow-system namespace that provides the mlflow Dashboard to LoadBalancer to receive load balancing function from MetalLB."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get svc/mlflow-server-service -n mlflow-system\n")),(0,l.kt)("p",null,"The type of this service is ClusterIP and you can confirm that the External-IP value is ",(0,l.kt)("inlineCode",{parentName:"p"},"none"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"NAME                    TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE\nmlflow-server-service   ClusterIP   10.111.173.209   <none>        5000/TCP   4m50s\n")),(0,l.kt)("p",null,"Change the type to LoadBalancer and if you want to input the desired IP address, add the loadBalancerIP item.",(0,l.kt)("br",{parentName:"p"}),"\n","If you do not add it, the IP address will be assigned sequentially from the IP address pool set above."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl edit svc/mlflow-server-service -n mlflow-system\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'apiVersion: v1\nkind: Service\nmetadata:\n  annotations:\n    meta.helm.sh/release-name: mlflow-server\n    meta.helm.sh/release-namespace: mlflow-system\n  creationTimestamp: "2022-01-07T04:00:19Z"\n  labels:\n    app.kubernetes.io/managed-by: Helm\n  name: mlflow-server-service\n  namespace: mlflow-system\n  resourceVersion: "276246"\n  uid: e5d39fb7-ad98-47e7-b512-f9c673055356\nspec:\n  clusterIP: 10.111.173.209\n  clusterIPs:\n  - 10.111.173.209\n  ipFamilies:\n  - IPv4\n  ipFamilyPolicy: SingleStack\n  ports:\n  - port: 5000\n    protocol: TCP\n    targetPort: 5000\n  selector:\n    app.kubernetes.io/name: mlflow-server\n  sessionAffinity: None\n  type: LoadBalancer # Change ClusterIP to LoadBalancer\n  loadBalancerIP: 192.168.35.102 # Add IP\nstatus:\n  loadBalancer: {}\n')),(0,l.kt)("p",null,"If we check again, we can see that the External-IP value is ",(0,l.kt)("inlineCode",{parentName:"p"},"192.168.35.102"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get svc/mlflow-server-service -n mlflow-system\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"NAME                    TYPE           CLUSTER-IP       EXTERNAL-IP      PORT(S)          AGE\nmlflow-server-service   LoadBalancer   10.111.173.209   192.168.35.102   5000:32287/TCP   6m11s\n")),(0,l.kt)("p",null,"Open the web browser and connect to ",(0,l.kt)("a",{parentName:"p",href:"http://192.168.35.102:5000"},"http://192.168.35.102:5000")," to confirm the following screen is displayed."),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"login-after-mlflow-setting.png",src:t(529).Z,width:"1922",height:"1082"})),(0,l.kt)("h3",{id:"grafana-dashboard"},"Grafana Dashboard"),(0,l.kt)("p",null,"First, check the current status before changing the type of seldon-core-analytics-grafana service in the seldon-system namespace which provides Grafana's Dashboard to receive Load Balancing function from MetalLB."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get svc/seldon-core-analytics-grafana -n seldon-system\n")),(0,l.kt)("p",null,"The type of the corresponding service is ClusterIP, and you can see that the External-IP value is ",(0,l.kt)("inlineCode",{parentName:"p"},"none"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"NAME                            TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE\nseldon-core-analytics-grafana   ClusterIP   10.109.20.161   <none>        80/TCP    94s\n")),(0,l.kt)("p",null,"Change the type to LoadBalancer and if you want to enter an IP address, add the loadBalancerIP item.",(0,l.kt)("br",{parentName:"p"}),"\n","If not, an IP address will be assigned sequentially from the IP address pool set above."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl edit svc/seldon-core-analytics-grafana -n seldon-system\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'apiVersion: v1\nkind: Service\nmetadata:\n  annotations:\n    meta.helm.sh/release-name: seldon-core-analytics\n    meta.helm.sh/release-namespace: seldon-system\n  creationTimestamp: "2022-01-07T04:16:47Z"\n  labels:\n    app.kubernetes.io/instance: seldon-core-analytics\n    app.kubernetes.io/managed-by: Helm\n    app.kubernetes.io/name: grafana\n    app.kubernetes.io/version: 7.0.3\n    helm.sh/chart: grafana-5.1.4\n  name: seldon-core-analytics-grafana\n  namespace: seldon-system\n  resourceVersion: "280605"\n  uid: 75073b78-92ec-472c-b0d5-240038ea8fa5\nspec:\n  clusterIP: 10.109.20.161\n  clusterIPs:\n  - 10.109.20.161\n  ipFamilies:\n  - IPv4\n  ipFamilyPolicy: SingleStack\n  ports:\n  - name: service\n    port: 80\n    protocol: TCP\n    targetPort: 3000\n  selector:\n    app.kubernetes.io/instance: seldon-core-analytics\n    app.kubernetes.io/name: grafana\n  sessionAffinity: None\n  type: LoadBalancer # Change ClusterIP to LoadBalancer\n  loadBalancerIP: 192.168.35.103 # Add IP\nstatus:\n  loadBalancer: {}\n')),(0,l.kt)("p",null,"If you check again, you can see that the External-IP value is ",(0,l.kt)("inlineCode",{parentName:"p"},"192.168.35.103"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get svc/seldon-core-analytics-grafana -n seldon-system\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"NAME                            TYPE           CLUSTER-IP      EXTERNAL-IP      PORT(S)        AGE\nseldon-core-analytics-grafana   LoadBalancer   10.109.20.161   192.168.35.103   80:31191/TCP   5m14s\n")),(0,l.kt)("p",null,"Open the Web Browser and connect to ",(0,l.kt)("a",{parentName:"p",href:"http://192.168.35.103:80"},"http://192.168.35.103:80")," to confirm that the following screen is displayed."),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"login-after-grafana-setting.png",src:t(428).Z,width:"1922",height:"1082"})))}u.isMDXComponent=!0},428:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/login-after-grafana-setting-95945b35a1316b2dbd1f0109991c0a0b.png"},4232:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/login-after-istio-ingressgateway-setting-3adfcf1bd5c4ddf45c54f4c4b5d4ceab.png"},9706:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/login-after-minio-setting-78fb86dafe3137ae3ecfbb49e2d7effb.png"},529:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/login-after-mlflow-setting-a4b0d197be47701209a6ef99612e89d6.png"}}]);