<!doctype html>
<html lang="ko" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-kubeflow/advanced-mlflow">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">12. Component - MLFlow | MLOps for ALL</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://mlops-for-all.github.io/img/logo-mlops-for-all.png"><meta data-rh="true" name="twitter:image" content="https://mlops-for-all.github.io/img/logo-mlops-for-all.png"><meta data-rh="true" property="og:url" content="https://mlops-for-all.github.io/docs/kubeflow/advanced-mlflow"><meta data-rh="true" name="docusaurus_locale" content="ko"><meta data-rh="true" name="docsearch:language" content="ko"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="12. Component - MLFlow | MLOps for ALL"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://mlops-for-all.github.io/docs/kubeflow/advanced-mlflow"><link data-rh="true" rel="alternate" href="https://mlops-for-all.github.io/en/docs/kubeflow/advanced-mlflow" hreflang="en"><link data-rh="true" rel="alternate" href="https://mlops-for-all.github.io/docs/kubeflow/advanced-mlflow" hreflang="ko"><link data-rh="true" rel="alternate" href="https://mlops-for-all.github.io/docs/kubeflow/advanced-mlflow" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-097K82469K"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-097K82469K",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.21f63a90.css">
<link rel="preload" href="/assets/js/runtime~main.1adf9bde.js" as="script">
<link rel="preload" href="/assets/js/main.a672047f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="본문으로 건너뛰기"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">본문으로 건너뛰기</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-mlops-for-all.png" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo-mlops-for-all.png" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">MLOps for ALL</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/introduction/intro">Tutorial</a><a class="navbar__item navbar__link" href="/docs/prerequisites/docker/install">Prerequisites</a><a class="navbar__item navbar__link" href="/community/contributors">Community</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/introduction/intro">1.0</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/kubeflow/advanced-mlflow">1.0</a></li><li><a class="dropdown__link" href="/docs/1.0/kubeflow/advanced-mlflow">1.0</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>한국어</a><ul class="dropdown__menu"><li><a href="/en/docs/kubeflow/advanced-mlflow" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/docs/kubeflow/advanced-mlflow" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="ko">한국어</a></li></ul></div><a href="https://github.com/mlops-for-all/mlops-for-all.github.io/tree/main/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="어두운 모드와 밝은 모드 전환하기 (현재 밝은 모드)" aria-label="어두운 모드와 밝은 모드 전환하기 (현재 밝은 모드)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="맨 위로 스크롤하기" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/introduction/intro">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/setup-kubernetes/intro">Setup Kubernetes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/setup-components/install-components-kf">Setup Components</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/kubeflow-dashboard-guide/intro">Kubeflow UI Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/kubeflow/kubeflow-intro">Kubeflow</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kubeflow/kubeflow-intro">1. Kubeflow Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kubeflow/kubeflow-concepts">2. Kubeflow Concepts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kubeflow/basic-requirements">3. Install Requirements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kubeflow/basic-component">4. Component - Write</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kubeflow/basic-pipeline">5. Pipeline - Write</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kubeflow/basic-pipeline-upload">6. Pipeline - Upload</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kubeflow/basic-run">7. Pipeline - Run</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kubeflow/advanced-component">8. Component - InputPath/OutputPath</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kubeflow/advanced-environment">9. Component - Environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kubeflow/advanced-pipeline">10. Pipeline - Setting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kubeflow/advanced-run">11. Pipeline - Run Result</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/kubeflow/advanced-mlflow">12. Component - MLFlow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kubeflow/how-to-debug">13. Component - Debugging</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/api-deployment/what-is-api-deployment">API Deployment</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/appendix/pyenv">Appendix</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/further-readings/info">Further Readings</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="홈" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Kubeflow</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">12. Component - MLFlow</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">버전: 1.0</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">이 페이지에서</button></div><div class="theme-doc-markdown markdown"><header><h1>12. Component - MLFlow</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mlflow-component">MLFlow Component<a href="#mlflow-component" class="hash-link" aria-label="MLFlow Component에 대한 직접 링크" title="MLFlow Component에 대한 직접 링크">​</a></h2><p><a href="/docs/kubeflow/advanced-component">Advanced Usage Component</a> 에서 학습한 모델이 API Deployment까지 이어지기 위해서는 MLFlow에 모델을 저장해야 합니다.</p><p>이번 페이지에서는 MLFlow에 모델을 저장할 수 있는 컴포넌트를 작성하는 과정을 설명합니다.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mlflow-in-local">MLFlow in Local<a href="#mlflow-in-local" class="hash-link" aria-label="MLFlow in Local에 대한 직접 링크" title="MLFlow in Local에 대한 직접 링크">​</a></h2><p>MLFlow에서 모델을 저장하고 서빙에서 사용하기 위해서는 다음의 항목들이 필요합니다.</p><ul><li>model</li><li>signature</li><li>input_example</li><li>conda_env</li></ul><p>파이썬 코드를 통해서 MLFLow에 모델을 저장하는 과정에 대해서 알아보겠습니다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-모델-학습">1. 모델 학습<a href="#1-모델-학습" class="hash-link" aria-label="1. 모델 학습에 대한 직접 링크" title="1. 모델 학습에 대한 직접 링크">​</a></h3><p>아래 과정은 iris 데이터를 이용해 SVC 모델을 학습하는 과정입니다.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> pd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">datasets </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> load_iris</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">svm </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> SVC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iris </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> load_iris</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;data&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> columns</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;feature_names&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;target&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> columns</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;target&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SVC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kernel</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;rbf&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-mlflow-infos">2. MLFLow Infos<a href="#2-mlflow-infos" class="hash-link" aria-label="2. MLFLow Infos에 대한 직접 링크" title="2. MLFLow Infos에 대한 직접 링크">​</a></h3><p>mlflow에 필요한 정보들을 만드는 과정입니다.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">signature </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> infer_signature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">utils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">environment </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> _mlflow_conda_env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input_example </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sample</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signature </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> infer_signature</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> clf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">conda_env </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> _mlflow_conda_env</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">additional_pip_deps</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;dill&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;pandas&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;scikit-learn&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>각 변수의 내용을 확인하면 다음과 같습니다.</p><ul><li><p><code>input_example</code></p><table><thead><tr><th>sepal length (cm)</th><th>sepal width (cm)</th><th>petal length (cm)</th><th>petal width (cm)</th></tr></thead><tbody><tr><td>6.5</td><td>6.7</td><td>3.1</td><td>4.4</td></tr></tbody></table></li><li><p><code>signature</code></p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">inputs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;sepal length (cm)&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> double</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;sepal width (cm)&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> double</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;petal length (cm)&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> double</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;petal width (cm)&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> double</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">outputs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Tensor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;int64&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><code>conda_env</code></p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&#x27;name&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;mlflow-env&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;channels&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;conda-forge&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;dependencies&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;python=3.8.10&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;pip&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&#x27;pip&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;mlflow&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;dill&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;pandas&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;scikit-learn&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-save-mlflow-infos">3. Save MLFLow Infos<a href="#3-save-mlflow-infos" class="hash-link" aria-label="3. Save MLFLow Infos에 대한 직접 링크" title="3. Save MLFLow Infos에 대한 직접 링크">​</a></h3><p>다음으로 학습한 정보들과 모델을 저장합니다.
학습한 모델이 sklearn 패키지를 이용하기 때문에 <code>mlflow.sklearn</code> 을 이용하면 쉽게 모델을 저장할 수 있습니다.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sklearn </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> save_model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">save_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sk_model</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">clf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;svc&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    serialization_format</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;cloudpickle&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conda_env</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">conda_env</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    signature</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">signature</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input_example</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">input_example</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>로컬에서 작업하면 다음과 같은 svc 폴더가 생기며 아래와 같은 파일들이 생성됩니다.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> svc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>위의 명령어를 실행하면 다음의 출력값을 확인할 수 있습니다.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MLmodel            conda.yaml         input_example.json model.pkl          requirements.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>각 파일을 확인하면 다음과 같습니다.</p><ul><li><p>MLmodel</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">flavors:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python_function:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    env: conda.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    loader_module: mlflow.sklearn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model_path: model.pkl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    python_version: </span><span class="token number" style="color:#36acaa">3.8</span><span class="token plain">.10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sklearn:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pickled_model: model.pkl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    serialization_format: cloudpickle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sklearn_version: </span><span class="token number" style="color:#36acaa">1.0</span><span class="token plain">.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">saved_input_example_info:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  artifact_path: input_example.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  pandas_orient: </span><span class="token function" style="color:#d73a49">split</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type: dataframe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signature:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  inputs: </span><span class="token string" style="color:#e3116c">&#x27;[{&quot;name&quot;: &quot;sepal length (cm)&quot;, &quot;type&quot;: &quot;double&quot;}, {&quot;name&quot;: &quot;sepal width</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    (cm)&quot;, &quot;type&quot;: &quot;double&quot;}, {&quot;name&quot;: &quot;petal length (cm)&quot;, &quot;type&quot;: &quot;double&quot;}, {&quot;name&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;petal width (cm)&quot;, &quot;type&quot;: &quot;double&quot;}]&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  outputs: </span><span class="token string" style="color:#e3116c">&#x27;[{&quot;type&quot;: &quot;tensor&quot;, &quot;tensor-spec&quot;: {&quot;dtype&quot;: &quot;int64&quot;, &quot;shape&quot;: [-1]}}]&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">utc_time_created: </span><span class="token string" style="color:#e3116c">&#x27;2021-12-06 06:52:30.612810&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>conda.yaml</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">channels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- conda-forge</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dependencies:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- </span><span class="token assign-left variable" style="color:#36acaa">python</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3.8</span><span class="token plain">.10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- pip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- pip:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - mlflow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - dill</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - pandas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - scikit-learn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name: mlflow-env</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>input_example.json</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;columns&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;sepal length (cm)&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;sepal width (cm)&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;petal length (cm)&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;petal width (cm)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;data&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">6.7</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">3.1</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">4.4</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">1.4</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>requirements.txt</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mlflow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dill</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pandas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scikit-learn</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>model.pkl</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mlflow-on-server">MLFlow on Server<a href="#mlflow-on-server" class="hash-link" aria-label="MLFlow on Server에 대한 직접 링크" title="MLFlow on Server에 대한 직접 링크">​</a></h2><p>이제 저장된 모델을 mlflow 서버에 올리는 작업을 해보겠습니다.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> mlflow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">start_run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log_artifact</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;svc/&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>저장하고 <code>mlruns</code> 가 생성된 경로에서 <code>mlflow ui</code> 명령어를 이용해 mlflow 서버와 대시보드를 띄웁니다.
mlflow 대시보드에 접속하여 생성된 run을 클릭하면 다음과 같이 보입니다.</p><p><img loading="lazy" alt="mlflow-0.png" src="/assets/images/mlflow-0-95d5ec759ef43b21c9c3b22abb64366d.png" width="2782" height="2496" class="img_ev3q">
(해당 화면은 mlflow 버전에 따라 다를 수 있습니다.)</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mlflow-component-1">MLFlow Component<a href="#mlflow-component-1" class="hash-link" aria-label="MLFlow Component에 대한 직접 링크" title="MLFlow Component에 대한 직접 링크">​</a></h2><p>이제 Kubeflow에서 재사용할 수 있는 컴포넌트를 작성해 보겠습니다.</p><p>재사용할 수 있는 컴포넌트를 작성하는 방법은 크게 3가지가 있습니다.</p><ol><li><p>모델을 학습하는 컴포넌트에서 필요한 환경을 저장 후 MLFlow 컴포넌트는 업로드만 담당</p><p><img loading="lazy" alt="mlflow-1.png" src="/assets/images/mlflow-1-a096f3eda2246a1c132fc13ce3180ef5.png" width="578" height="844" class="img_ev3q"></p></li><li><p>학습된 모델과 데이터를 MLFlow 컴포넌트에 전달 후 컴포넌트에서 저장과 업로드 담당</p><p><img loading="lazy" alt="mlflow-2.png" src="/assets/images/mlflow-2-3cd7cf7e2c853a1242cff7c65e56cf3f.png" width="900" height="846" class="img_ev3q"></p></li><li><p>모델을 학습하는 컴포넌트에서 저장과 업로드를 담당</p><p><img loading="lazy" alt="mlflow-3.png" src="/assets/images/mlflow-3-8b187057bb18f27b1744656ef6d045a1.png" width="578" height="406" class="img_ev3q"></p></li></ol><p>저희는 이 중 1번의 접근 방법을 통해 모델을 관리하려고 합니다.
이유는 MLFlow 모델을 업로드하는 코드는 바뀌지 않기 때문에 매번 3번처럼 컴포넌트 작성마다 작성할 필요는 없기 때문입니다.</p><p>컴포넌트를 재활용하는 방법은 1번과 2번의 방법으로 가능합니다.
다만 2번의 경우 모델이 학습된 이미지와 패키지들을 전달해야 하므로 결국 컴포넌트에 대한 추가 정보를 전달해야 합니다.</p><p>1번의 방법으로 진행하기 위해서는 학습하는 컴포넌트 또한 변경되어야 합니다.
모델을 저장하는데 필요한 환경들을 저장해주는 코드가 추가되어야 합니다.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> functools </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> partial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> kfp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">components </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> InputPath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> OutputPath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> create_component_from_func</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@partial</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    create_component_from_func</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    packages_to_install</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;dill&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;pandas&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;scikit-learn&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;mlflow&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">train_from_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    train_data_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InputPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;csv&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    train_target_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InputPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;csv&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OutputPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dill&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input_example_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OutputPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dill&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    signature_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OutputPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dill&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conda_env_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OutputPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dill&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kernel</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> dill</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> pd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">svm </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> SVC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">signature </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> infer_signature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">utils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">environment </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> _mlflow_conda_env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    train_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_data_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    train_target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_target_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SVC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kernel</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">kernel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> train_target</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> mode</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;wb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> file_writer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dill</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">clf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> file_writer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input_example </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> train_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sample</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">input_example_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;wb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> file_writer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dill</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">input_example</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> file_writer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    signature </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> infer_signature</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> clf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signature_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;wb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> file_writer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dill</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signature</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> file_writer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conda_env </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> _mlflow_conda_env</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        additional_pip_deps</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;dill&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;pandas&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;scikit-learn&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conda_env_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;wb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> file_writer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dill</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conda_env</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> file_writer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>그리고 MLFlow에 업로드하는 컴포넌트를 작성합니다.
이 때 업로드되는 MLflow의 endpoint를 우리가 설치한 <a href="/docs/setup-components/install-components-mlflow">mlflow service</a> 로 이어지게 설정해주어야 합니다.<br>
<!-- -->이 때 S3 Endpoint의 주소는 MLflow Server 설치 당시 설치한 minio의 <a href="https://kubernetes.io/ko/docs/concepts/services-networking/dns-pod-service/" target="_blank" rel="noopener noreferrer">쿠버네티스 서비스 DNS 네임을 활용</a>합니다. 해당 service 는 kubeflow namespace에서 minio-service라는 이름으로 생성되었으므로, <code>http://minio-service.kubeflow.svc:9000</code> 로 설정합니다.<br>
<!-- -->이와 비슷하게 tracking_uri의 주소는 mlflow server의 쿠버네티스 서비스 DNS 네임을 활용하여, <code>http://mlflow-server-service.mlflow-system.svc:5000</code> 로 설정합니다.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> functools </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> partial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> kfp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">components </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> InputPath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> create_component_from_func</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@partial</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    create_component_from_func</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    packages_to_install</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;dill&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;pandas&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;scikit-learn&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;mlflow&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;boto3&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">upload_sklearn_model_to_mlflow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InputPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dill&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input_example_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InputPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dill&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    signature_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InputPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dill&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conda_env_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InputPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dill&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> dill</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sklearn </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> save_model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tracking</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">client </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> MlflowClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;MLFLOW_S3_ENDPOINT_URL&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://minio-service.kubeflow.svc:9000&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;AWS_ACCESS_KEY_ID&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;minio&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;AWS_SECRET_ACCESS_KEY&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;minio123&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> MlflowClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;http://mlflow-server-service.mlflow-system.svc:5000&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> mode</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;rb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> file_reader</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        clf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dill</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_reader</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">input_example_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> file_reader</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        input_example </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dill</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_reader</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signature_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> file_reader</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        signature </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dill</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_reader</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conda_env_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> file_reader</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        conda_env </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dill</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_reader</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    save_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sk_model</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">clf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">model_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        serialization_format</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;cloudpickle&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        conda_env</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">conda_env</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        signature</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">signature</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        input_example</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">input_example</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    run </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">create_run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">experiment_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;0&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log_artifact</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> model_name</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mlflow-pipeline">MLFlow Pipeline<a href="#mlflow-pipeline" class="hash-link" aria-label="MLFlow Pipeline에 대한 직접 링크" title="MLFlow Pipeline에 대한 직접 링크">​</a></h2><p>이제 작성한 컴포넌트들을 연결해서 파이프라인으로 만들어 보겠습니다.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="data-component">Data Component<a href="#data-component" class="hash-link" aria-label="Data Component에 대한 직접 링크" title="Data Component에 대한 직접 링크">​</a></h3><p>모델을 학습할 때 쓸 데이터는 sklearn의 iris 입니다.
데이터를 생성하는 컴포넌트를 작성합니다.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> functools </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> partial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> kfp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">components </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> InputPath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> OutputPath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> create_component_from_func</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@partial</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    create_component_from_func</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    packages_to_install</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;pandas&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;scikit-learn&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">load_iris_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OutputPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;csv&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OutputPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;csv&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> pd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">datasets </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> load_iris</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    iris </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> load_iris</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;data&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> columns</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;feature_names&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;target&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> columns</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;target&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> index</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> index</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pipeline">Pipeline<a href="#pipeline" class="hash-link" aria-label="Pipeline에 대한 직접 링크" title="Pipeline에 대한 직접 링크">​</a></h3><p>파이프라인 코드는 다음과 같이 작성할 수 있습니다.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> kfp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dsl </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@pipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;mlflow_pipeline&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mlflow_pipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kernel</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> model_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    iris_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> load_iris_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> train_from_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        train_data</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">iris_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">outputs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;data&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        train_target</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">iris_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">outputs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;target&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        kernel</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">kernel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> upload_sklearn_model_to_mlflow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        model_name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">model_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        model</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">outputs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;model&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        input_example</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">outputs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;input_example&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        signature</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">outputs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;signature&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        conda_env</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">outputs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;conda_env&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="run">Run<a href="#run" class="hash-link" aria-label="Run에 대한 직접 링크" title="Run에 대한 직접 링크">​</a></h3><p>위에서 작성된 컴포넌트와 파이프라인을 하나의 파이썬 파일에 정리하면 다음과 같습니다.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> functools </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> partial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> kfp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> kfp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">components </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> InputPath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> OutputPath</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> create_component_from_func</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> kfp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dsl </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@partial</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    create_component_from_func</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    packages_to_install</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;pandas&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;scikit-learn&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">load_iris_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OutputPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;csv&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OutputPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;csv&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> pd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">datasets </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> load_iris</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    iris </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> load_iris</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;data&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> columns</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;feature_names&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;target&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> columns</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;target&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> index</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> index</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@partial</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    create_component_from_func</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    packages_to_install</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;dill&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;pandas&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;scikit-learn&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;mlflow&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">train_from_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    train_data_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InputPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;csv&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    train_target_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InputPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;csv&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OutputPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dill&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input_example_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OutputPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dill&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    signature_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OutputPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dill&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conda_env_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> OutputPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dill&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kernel</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> dill</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> pd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">svm </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> SVC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">signature </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> infer_signature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">utils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">environment </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> _mlflow_conda_env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    train_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_data_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    train_target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_target_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SVC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kernel</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">kernel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> train_target</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> mode</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;wb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> file_writer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dill</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">clf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> file_writer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input_example </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> train_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sample</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">input_example_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;wb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> file_writer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dill</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">input_example</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> file_writer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    signature </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> infer_signature</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> clf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signature_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;wb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> file_writer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dill</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signature</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> file_writer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conda_env </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> _mlflow_conda_env</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        additional_pip_deps</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;dill&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;pandas&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;scikit-learn&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conda_env_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;wb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> file_writer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dill</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conda_env</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> file_writer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@partial</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    create_component_from_func</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    packages_to_install</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;dill&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;pandas&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;scikit-learn&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;mlflow&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;boto3&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">upload_sklearn_model_to_mlflow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InputPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dill&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input_example_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InputPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dill&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    signature_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InputPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dill&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    conda_env_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> InputPath</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dill&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> dill</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sklearn </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> save_model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mlflow</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tracking</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">client </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> MlflowClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;MLFLOW_S3_ENDPOINT_URL&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://minio-service.kubeflow.svc:9000&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;AWS_ACCESS_KEY_ID&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;minio&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;AWS_SECRET_ACCESS_KEY&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;minio123&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> MlflowClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;http://mlflow-server-service.mlflow-system.svc:5000&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> mode</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;rb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> file_reader</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        clf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dill</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_reader</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">input_example_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> file_reader</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        input_example </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dill</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_reader</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signature_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> file_reader</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        signature </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dill</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_reader</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conda_env_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> file_reader</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        conda_env </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dill</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_reader</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    save_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sk_model</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">clf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">model_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        serialization_format</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;cloudpickle&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        conda_env</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">conda_env</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        signature</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">signature</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        input_example</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">input_example</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    run </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">create_run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">experiment_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;0&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">log_artifact</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> model_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@pipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;mlflow_pipeline&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mlflow_pipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kernel</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> model_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    iris_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> load_iris_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> train_from_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        train_data</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">iris_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">outputs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;data&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        train_target</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">iris_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">outputs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;target&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        kernel</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">kernel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> upload_sklearn_model_to_mlflow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        model_name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">model_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        model</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">outputs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;model&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        input_example</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">outputs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;input_example&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        signature</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">outputs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;signature&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        conda_env</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">outputs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;conda_env&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;__main__&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kfp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">compiler</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Compiler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">compile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mlflow_pipeline</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;mlflow_pipeline.yaml&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p></p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>mlflow_pipeline.yaml</summary><div><div class="collapsibleContent_i85q"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: argoproj.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Workflow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  generateName: mlflow-pipeline-</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  annotations: </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">pipelines.kubeflow.org/kfp_sdk_version: </span><span class="token number" style="color:#36acaa">1.8</span><span class="token plain">.10, pipelines.kubeflow.org/pipeline_compilation_time: </span><span class="token string" style="color:#e3116c">&#x27;2022-01-19T14:14:11.999807&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pipelines.kubeflow.org/pipeline_spec: </span><span class="token string" style="color:#e3116c">&#x27;{&quot;inputs&quot;: [{&quot;name&quot;: &quot;kernel&quot;, &quot;type&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">      &quot;String&quot;}, {&quot;name&quot;: &quot;model_name&quot;, &quot;type&quot;: &quot;String&quot;}], &quot;name&quot;: &quot;mlflow_pipeline&quot;}&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels: </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">pipelines.kubeflow.org/kfp_sdk_version: </span><span class="token number" style="color:#36acaa">1.8</span><span class="token plain">.10</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  entrypoint: mlflow-pipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  templates:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - name: load-iris-data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      args: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">--data, /tmp/outputs/data/data, --target, /tmp/outputs/target/data</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      command:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - -c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">PIP_DISABLE_PIP_VERSION_CHECK</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> python3 -m pip </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> --quiet --no-warn-script-location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;pandas&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;scikit-learn&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">PIP_DISABLE_PIP_VERSION_CHECK</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> python3 -m pip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> --quiet --no-warn-script-location </span><span class="token string" style="color:#e3116c">&#x27;pandas&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;scikit-learn&#x27;</span><span class="token plain"> --user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$0</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$@</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - -ec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token assign-left variable" style="color:#36acaa">program_path</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">mktemp</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">printf</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;%s&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$0</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$program_path</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        python3 -u </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$program_path</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$@</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        def _make_parent_dirs_and_return_path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path: str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            os.makedirs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">os.path.dirname</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">exist_ok</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token builtin class-name">return</span><span class="token plain"> file_path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        def load_iris_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            data_path,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            target_path,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> pandas as pd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            from sklearn.datasets </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> load_iris</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            iris </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> load_iris</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd.DataFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;data&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">columns</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;feature_names&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd.DataFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;target&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">columns</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;target&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            data.to_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data_path, </span><span class="token assign-left variable" style="color:#36acaa">index</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            target.to_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target_path, </span><span class="token assign-left variable" style="color:#36acaa">index</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> argparse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _parser </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> argparse.ArgumentParser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prog</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;Load iris data&#x27;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">description</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _parser.add_argument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;--data&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">dest</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;data_path&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">_make_parent_dirs_and_return_path, </span><span class="token assign-left variable" style="color:#36acaa">required</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">True, </span><span class="token assign-left variable" style="color:#36acaa">default</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">argparse.SUPPRESS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _parser.add_argument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;--target&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">dest</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;target_path&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">_make_parent_dirs_and_return_path, </span><span class="token assign-left variable" style="color:#36acaa">required</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">True, </span><span class="token assign-left variable" style="color:#36acaa">default</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">argparse.SUPPRESS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _parsed_args </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> vars</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_parser.parse_args</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _outputs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> load_iris_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">**_parsed_args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      image: python:3.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    outputs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      artifacts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: load-iris-data-data, path: /tmp/outputs/data/data</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: load-iris-data-target, path: /tmp/outputs/target/data</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pipelines.kubeflow.org/kfp_sdk_version: </span><span class="token number" style="color:#36acaa">1.8</span><span class="token plain">.10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pipelines.kubeflow.org/pipeline-sdk-type: kfp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pipelines.kubeflow.org/enable_caching: </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      annotations: </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">pipelines.kubeflow.org/component_spec: </span><span class="token string" style="color:#e3116c">&#x27;{&quot;implementation&quot;: {&quot;container&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          {&quot;args&quot;: [&quot;--data&quot;, {&quot;outputPath&quot;: &quot;data&quot;}, &quot;--target&quot;, {&quot;outputPath&quot;: &quot;target&quot;}],</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          &quot;command&quot;: [&quot;sh&quot;, &quot;-c&quot;, &quot;(PIP_DISABLE_PIP_VERSION_CHECK=1 python3 -m pip</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          install --quiet --no-warn-script-location &#x27;</span><span class="token plain">&#x27;pandas</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">scikit-learn</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token assign-left variable" style="color:#36acaa">PIP_DISABLE_PIP_VERSION_CHECK</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> python3 -m pip </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> --quiet --no-warn-script-location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">pandas</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">scikit-learn</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"> --user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token variable" style="color:#36acaa">$0</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot; </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token variable" style="color:#36acaa">$@</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token string" style="color:#e3116c">&quot;, &quot;</span><span class="token function" style="color:#d73a49">sh</span><span class="token string" style="color:#e3116c">&quot;, &quot;</span><span class="token plain">-ec</span><span class="token string" style="color:#e3116c">&quot;, &quot;</span><span class="token assign-left variable" style="color:#36acaa">program_path</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">mktemp</span><span class="token variable" style="color:#36acaa">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">nprintf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;%s</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot; </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token variable" style="color:#36acaa">$0</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot; </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token variable" style="color:#36acaa">$program_path</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">npython3 -u </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token variable" style="color:#36acaa">$program_path</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot; </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token variable" style="color:#36acaa">$@</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token string" style="color:#e3116c">&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          &quot;</span><span class="token plain">def _make_parent_dirs_and_return_path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path: str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    os.makedirs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">os.path.dirname</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token assign-left variable" style="color:#36acaa">exist_ok</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    </span><span class="token builtin class-name">return</span><span class="token plain"> file_path</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">ndef load_iris_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    data_path,</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    target_path,</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          pandas as pd</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    from sklearn.datasets </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> load_iris</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    iris </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> load_iris</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd.DataFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;data</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">columns</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;feature_names</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd.DataFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;target</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">columns</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;target</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    data.to_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data_path,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token assign-left variable" style="color:#36acaa">index</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    target.to_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target_path, </span><span class="token assign-left variable" style="color:#36acaa">index</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">nimport argparse</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n_parser</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> argparse.ArgumentParser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prog</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">Load iris data</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">description</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">&#x27;</span><span class="token string" style="color:#e3116c">&#x27;)\n_parser.add_argument(\&quot;--data\&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          dest=\&quot;data_path\&quot;, type=_make_parent_dirs_and_return_path, required=True,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          default=argparse.SUPPRESS)\n_parser.add_argument(\&quot;--target\&quot;, dest=\&quot;target_path\&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          type=_make_parent_dirs_and_return_path, required=True, default=argparse.SUPPRESS)\n_parsed_args</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          = vars(_parser.parse_args())\n\n_outputs = load_iris_data(**_parsed_args)\n&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          &quot;image&quot;: &quot;python:3.7&quot;}}, &quot;name&quot;: &quot;Load iris data&quot;, &quot;outputs&quot;: [{&quot;name&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          &quot;data&quot;, &quot;type&quot;: &quot;csv&quot;}, {&quot;name&quot;: &quot;target&quot;, &quot;type&quot;: &quot;csv&quot;}]}&#x27;</span><span class="token plain">, pipelines.kubeflow.org/component_ref: </span><span class="token string" style="color:#e3116c">&#x27;{}&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - name: mlflow-pipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    inputs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      parameters:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: kernel</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: model_name</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dag:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tasks:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: load-iris-data, template: load-iris-data</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: train-from-csv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        template: train-from-csv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dependencies: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">load-iris-data</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        arguments:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          parameters:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: kernel, value: </span><span class="token string" style="color:#e3116c">&#x27;{{inputs.parameters.kernel}}&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          artifacts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: load-iris-data-data, from: </span><span class="token string" style="color:#e3116c">&#x27;{{tasks.load-iris-data.outputs.artifacts.load-iris-data-data}}&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: load-iris-data-target, from: </span><span class="token string" style="color:#e3116c">&#x27;{{tasks.load-iris-data.outputs.artifacts.load-iris-data-target}}&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: upload-sklearn-model-to-mlflow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        template: upload-sklearn-model-to-mlflow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dependencies: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">train-from-csv</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        arguments:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          parameters:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: model_name, value: </span><span class="token string" style="color:#e3116c">&#x27;{{inputs.parameters.model_name}}&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          artifacts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: train-from-csv-conda_env, from: </span><span class="token string" style="color:#e3116c">&#x27;{{tasks.train-from-csv.outputs.artifacts.train-from-csv-conda_env}}&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: train-from-csv-input_example, from: </span><span class="token string" style="color:#e3116c">&#x27;{{tasks.train-from-csv.outputs.artifacts.train-from-csv-input_example}}&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: train-from-csv-model, from: </span><span class="token string" style="color:#e3116c">&#x27;{{tasks.train-from-csv.outputs.artifacts.train-from-csv-model}}&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: train-from-csv-signature, from: </span><span class="token string" style="color:#e3116c">&#x27;{{tasks.train-from-csv.outputs.artifacts.train-from-csv-signature}}&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - name: train-from-csv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      args: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">--train-data, /tmp/inputs/train_data/data, --train-target, /tmp/inputs/train_target/data,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --kernel, </span><span class="token string" style="color:#e3116c">&#x27;{{inputs.parameters.kernel}}&#x27;</span><span class="token plain">, --model, /tmp/outputs/model/data,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --input-example, /tmp/outputs/input_example/data, --signature, /tmp/outputs/signature/data,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --conda-env, /tmp/outputs/conda_env/data</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      command:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - -c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">PIP_DISABLE_PIP_VERSION_CHECK</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> python3 -m pip </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> --quiet --no-warn-script-location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;dill&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;pandas&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;scikit-learn&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;mlflow&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">PIP_DISABLE_PIP_VERSION_CHECK</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        python3 -m pip </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> --quiet --no-warn-script-location </span><span class="token string" style="color:#e3116c">&#x27;dill&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;pandas&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;scikit-learn&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;mlflow&#x27;</span><span class="token plain"> --user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$0</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$@</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - -ec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token assign-left variable" style="color:#36acaa">program_path</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">mktemp</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">printf</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;%s&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$0</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$program_path</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        python3 -u </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$program_path</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$@</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        def _make_parent_dirs_and_return_path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path: str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            os.makedirs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">os.path.dirname</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">exist_ok</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token builtin class-name">return</span><span class="token plain"> file_path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        def train_from_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            train_data_path,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            train_target_path,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            model_path,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            input_example_path,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            signature_path,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            conda_env_path,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            kernel,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> dill</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> pandas as pd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            from sklearn.svm </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> SVC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            from mlflow.models.signature </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> infer_signature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            from mlflow.utils.environment </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> _mlflow_conda_env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            train_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd.read_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_data_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            train_target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd.read_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_target_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            clf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SVC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kernel</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">kernel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            clf.fit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_data, train_target</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            with open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model_path, </span><span class="token assign-left variable" style="color:#36acaa">mode</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;wb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> as file_writer:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                dill.dump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">clf, file_writer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            input_example </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> train_data.sample</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            with open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">input_example_path, </span><span class="token string" style="color:#e3116c">&quot;wb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> as file_writer:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                dill.dump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">input_example, file_writer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            signature </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> infer_signature</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_data, clf.predict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_data</span><span class="token punctuation" style="color:#393A34">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            with open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signature_path, </span><span class="token string" style="color:#e3116c">&quot;wb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> as file_writer:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                dill.dump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signature, file_writer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            conda_env </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> _mlflow_conda_env</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token assign-left variable" style="color:#36acaa">additional_pip_deps</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;dill&quot;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;pandas&quot;</span><span class="token plain">, </span><span class="token string" style="color:#e3116c">&quot;scikit-learn&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            with open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conda_env_path, </span><span class="token string" style="color:#e3116c">&quot;wb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> as file_writer:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                dill.dump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conda_env, file_writer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> argparse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _parser </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> argparse.ArgumentParser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prog</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;Train from csv&#x27;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">description</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _parser.add_argument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;--train-data&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">dest</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;train_data_path&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">str, </span><span class="token assign-left variable" style="color:#36acaa">required</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">True, </span><span class="token assign-left variable" style="color:#36acaa">default</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">argparse.SUPPRESS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _parser.add_argument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;--train-target&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">dest</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;train_target_path&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">str, </span><span class="token assign-left variable" style="color:#36acaa">required</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">True, </span><span class="token assign-left variable" style="color:#36acaa">default</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">argparse.SUPPRESS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _parser.add_argument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;--kernel&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">dest</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;kernel&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">str, </span><span class="token assign-left variable" style="color:#36acaa">required</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">True, </span><span class="token assign-left variable" style="color:#36acaa">default</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">argparse.SUPPRESS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _parser.add_argument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;--model&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">dest</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;model_path&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">_make_parent_dirs_and_return_path, </span><span class="token assign-left variable" style="color:#36acaa">required</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">True, </span><span class="token assign-left variable" style="color:#36acaa">default</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">argparse.SUPPRESS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _parser.add_argument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;--input-example&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">dest</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;input_example_path&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">_make_parent_dirs_and_return_path, </span><span class="token assign-left variable" style="color:#36acaa">required</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">True, </span><span class="token assign-left variable" style="color:#36acaa">default</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">argparse.SUPPRESS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _parser.add_argument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;--signature&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">dest</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;signature_path&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">_make_parent_dirs_and_return_path, </span><span class="token assign-left variable" style="color:#36acaa">required</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">True, </span><span class="token assign-left variable" style="color:#36acaa">default</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">argparse.SUPPRESS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _parser.add_argument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;--conda-env&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">dest</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;conda_env_path&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">_make_parent_dirs_and_return_path, </span><span class="token assign-left variable" style="color:#36acaa">required</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">True, </span><span class="token assign-left variable" style="color:#36acaa">default</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">argparse.SUPPRESS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _parsed_args </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> vars</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_parser.parse_args</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _outputs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> train_from_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">**_parsed_args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      image: python:3.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    inputs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      parameters:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: kernel</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      artifacts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: load-iris-data-data, path: /tmp/inputs/train_data/data</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: load-iris-data-target, path: /tmp/inputs/train_target/data</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    outputs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      artifacts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: train-from-csv-conda_env, path: /tmp/outputs/conda_env/data</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: train-from-csv-input_example, path: /tmp/outputs/input_example/data</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: train-from-csv-model, path: /tmp/outputs/model/data</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: train-from-csv-signature, path: /tmp/outputs/signature/data</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pipelines.kubeflow.org/kfp_sdk_version: </span><span class="token number" style="color:#36acaa">1.8</span><span class="token plain">.10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pipelines.kubeflow.org/pipeline-sdk-type: kfp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pipelines.kubeflow.org/enable_caching: </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      annotations: </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">pipelines.kubeflow.org/component_spec: </span><span class="token string" style="color:#e3116c">&#x27;{&quot;implementation&quot;: {&quot;container&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          {&quot;args&quot;: [&quot;--train-data&quot;, {&quot;inputPath&quot;: &quot;train_data&quot;}, &quot;--train-target&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          {&quot;inputPath&quot;: &quot;train_target&quot;}, &quot;--kernel&quot;, {&quot;inputValue&quot;: &quot;kernel&quot;}, &quot;--model&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          {&quot;outputPath&quot;: &quot;model&quot;}, &quot;--input-example&quot;, {&quot;outputPath&quot;: &quot;input_example&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          &quot;--signature&quot;, {&quot;outputPath&quot;: &quot;signature&quot;}, &quot;--conda-env&quot;, {&quot;outputPath&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          &quot;conda_env&quot;}], &quot;command&quot;: [&quot;sh&quot;, &quot;-c&quot;, &quot;(PIP_DISABLE_PIP_VERSION_CHECK=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          python3 -m pip install --quiet --no-warn-script-location &#x27;</span><span class="token plain">&#x27;dill</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">pandas</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">scikit-learn</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">mlflow</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">PIP_DISABLE_PIP_VERSION_CHECK</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> python3 -m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          pip </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> --quiet --no-warn-script-location </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">dill</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">pandas</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">scikit-learn</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">mlflow</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"> --user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token variable" style="color:#36acaa">$0</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot; </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token variable" style="color:#36acaa">$@</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token string" style="color:#e3116c">&quot;, &quot;</span><span class="token function" style="color:#d73a49">sh</span><span class="token string" style="color:#e3116c">&quot;, &quot;</span><span class="token plain">-ec</span><span class="token string" style="color:#e3116c">&quot;, &quot;</span><span class="token assign-left variable" style="color:#36acaa">program_path</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">mktemp</span><span class="token variable" style="color:#36acaa">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">nprintf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;%s</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot; </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token variable" style="color:#36acaa">$0</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot; </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token variable" style="color:#36acaa">$program_path</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">npython3 -u </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token variable" style="color:#36acaa">$program_path</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot; </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token variable" style="color:#36acaa">$@</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token string" style="color:#e3116c">&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          &quot;</span><span class="token plain">def _make_parent_dirs_and_return_path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path: str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    os.makedirs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">os.path.dirname</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token assign-left variable" style="color:#36acaa">exist_ok</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    </span><span class="token builtin class-name">return</span><span class="token plain"> file_path</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">ndef train_from_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    train_data_path,</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    train_target_path,</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    model_path,</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    input_example_path,</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    signature_path,</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    conda_env_path,</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    kernel,</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          dill</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> pandas as pd</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    from sklearn.svm </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> SVC</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          mlflow.models.signature </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> infer_signature</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    from mlflow.utils.environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> _mlflow_conda_env</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    train_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd.read_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_data_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    train_target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd.read_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_target_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    clf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SVC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kernel</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">kernel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    clf.fit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_data,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          train_target</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    with open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model_path, </span><span class="token assign-left variable" style="color:#36acaa">mode</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;wb</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> as file_writer:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n        dill.dump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">clf,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          file_writer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    input_example </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> train_data.sample</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    with open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">input_example_path,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;wb</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> as file_writer:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n        dill.dump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">input_example, file_writer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    signature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> infer_signature</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_data, clf.predict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_data</span><span class="token punctuation" style="color:#393A34">))</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    with open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signature_path,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;wb</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> as file_writer:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n        dill.dump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signature, file_writer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    conda_env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> _mlflow_conda_env</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n        </span><span class="token assign-left variable" style="color:#36acaa">additional_pip_deps</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;dill</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;, </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;pandas</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;scikit-learn</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    with open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conda_env_path, </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;wb</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> as file_writer:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n        dill.dump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conda_env,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          file_writer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">nimport argparse</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n_parser </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> argparse.ArgumentParser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prog</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">Train</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          from csv</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">description</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">&#x27;</span><span class="token string" style="color:#e3116c">&#x27;)\n_parser.add_argument(\&quot;--train-data\&quot;, dest=\&quot;train_data_path\&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          type=str, required=True, default=argparse.SUPPRESS)\n_parser.add_argument(\&quot;--train-target\&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          dest=\&quot;train_target_path\&quot;, type=str, required=True, default=argparse.SUPPRESS)\n_parser.add_argument(\&quot;--kernel\&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          dest=\&quot;kernel\&quot;, type=str, required=True, default=argparse.SUPPRESS)\n_parser.add_argument(\&quot;--model\&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          dest=\&quot;model_path\&quot;, type=_make_parent_dirs_and_return_path, required=True,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          default=argparse.SUPPRESS)\n_parser.add_argument(\&quot;--input-example\&quot;, dest=\&quot;input_example_path\&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          type=_make_parent_dirs_and_return_path, required=True, default=argparse.SUPPRESS)\n_parser.add_argument(\&quot;--signature\&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          dest=\&quot;signature_path\&quot;, type=_make_parent_dirs_and_return_path, required=True,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          default=argparse.SUPPRESS)\n_parser.add_argument(\&quot;--conda-env\&quot;, dest=\&quot;conda_env_path\&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          type=_make_parent_dirs_and_return_path, required=True, default=argparse.SUPPRESS)\n_parsed_args</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          = vars(_parser.parse_args())\n\n_outputs = train_from_csv(**_parsed_args)\n&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          &quot;image&quot;: &quot;python:3.7&quot;}}, &quot;inputs&quot;: [{&quot;name&quot;: &quot;train_data&quot;, &quot;type&quot;: &quot;csv&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          {&quot;name&quot;: &quot;train_target&quot;, &quot;type&quot;: &quot;csv&quot;}, {&quot;name&quot;: &quot;kernel&quot;, &quot;type&quot;: &quot;String&quot;}],</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          &quot;name&quot;: &quot;Train from csv&quot;, &quot;outputs&quot;: [{&quot;name&quot;: &quot;model&quot;, &quot;type&quot;: &quot;dill&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          {&quot;name&quot;: &quot;input_example&quot;, &quot;type&quot;: &quot;dill&quot;}, {&quot;name&quot;: &quot;signature&quot;, &quot;type&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          &quot;dill&quot;}, {&quot;name&quot;: &quot;conda_env&quot;, &quot;type&quot;: &quot;dill&quot;}]}&#x27;</span><span class="token plain">, pipelines.kubeflow.org/component_ref: </span><span class="token string" style="color:#e3116c">&#x27;{}&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pipelines.kubeflow.org/arguments.parameters: </span><span class="token string" style="color:#e3116c">&#x27;{&quot;kernel&quot;: &quot;{{inputs.parameters.kernel}}&quot;}&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - name: upload-sklearn-model-to-mlflow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    container:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      args: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">--model-name, </span><span class="token string" style="color:#e3116c">&#x27;{{inputs.parameters.model_name}}&#x27;</span><span class="token plain">, --model, /tmp/inputs/model/data,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --input-example, /tmp/inputs/input_example/data, --signature, /tmp/inputs/signature/data,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --conda-env, /tmp/inputs/conda_env/data</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      command:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - -c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">PIP_DISABLE_PIP_VERSION_CHECK</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> python3 -m pip </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> --quiet --no-warn-script-location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;dill&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;pandas&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;scikit-learn&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;mlflow&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;boto3&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">PIP_DISABLE_PIP_VERSION_CHECK</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        python3 -m pip </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> --quiet --no-warn-script-location </span><span class="token string" style="color:#e3116c">&#x27;dill&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;pandas&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;scikit-learn&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;mlflow&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;boto3&#x27;</span><span class="token plain"> --user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$0</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$@</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - -ec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token assign-left variable" style="color:#36acaa">program_path</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">mktemp</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">printf</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;%s&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$0</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$program_path</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        python3 -u </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$program_path</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$@</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        def upload_sklearn_model_to_mlflow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            model_name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            model_path,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            input_example_path,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            signature_path,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            conda_env_path,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> dill</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            from mlflow.sklearn </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> save_model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            from mlflow.tracking.client </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> MlflowClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            os.environ</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;MLFLOW_S3_ENDPOINT_URL&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://minio-service.kubeflow.svc:9000&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            os.environ</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;AWS_ACCESS_KEY_ID&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;minio&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            os.environ</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;AWS_SECRET_ACCESS_KEY&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;minio123&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> MlflowClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;http://mlflow-server-service.mlflow-system.svc:5000&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            with open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model_path, </span><span class="token assign-left variable" style="color:#36acaa">mode</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;rb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> as file_reader:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                clf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dill.load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_reader</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            with open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">input_example_path, </span><span class="token string" style="color:#e3116c">&quot;rb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> as file_reader:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                input_example </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dill.load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_reader</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            with open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signature_path, </span><span class="token string" style="color:#e3116c">&quot;rb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> as file_reader:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                signature </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dill.load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_reader</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            with open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conda_env_path, </span><span class="token string" style="color:#e3116c">&quot;rb&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> as file_reader:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                conda_env </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dill.load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_reader</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            save_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token assign-left variable" style="color:#36acaa">sk_model</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">clf,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token assign-left variable" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">model_name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token assign-left variable" style="color:#36acaa">serialization_format</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;cloudpickle&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token assign-left variable" style="color:#36acaa">conda_env</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">conda_env,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token assign-left variable" style="color:#36acaa">signature</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">signature,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token assign-left variable" style="color:#36acaa">input_example</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">input_example,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            run </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client.create_run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">experiment_id</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;0&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            client.log_artifact</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">run.info.run_id, model_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> argparse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _parser </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> argparse.ArgumentParser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prog</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;Upload sklearn model to mlflow&#x27;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">description</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _parser.add_argument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;--model-name&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">dest</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;model_name&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">str, </span><span class="token assign-left variable" style="color:#36acaa">required</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">True, </span><span class="token assign-left variable" style="color:#36acaa">default</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">argparse.SUPPRESS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _parser.add_argument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;--model&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">dest</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;model_path&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">str, </span><span class="token assign-left variable" style="color:#36acaa">required</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">True, </span><span class="token assign-left variable" style="color:#36acaa">default</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">argparse.SUPPRESS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _parser.add_argument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;--input-example&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">dest</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;input_example_path&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">str, </span><span class="token assign-left variable" style="color:#36acaa">required</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">True, </span><span class="token assign-left variable" style="color:#36acaa">default</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">argparse.SUPPRESS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _parser.add_argument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;--signature&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">dest</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;signature_path&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">str, </span><span class="token assign-left variable" style="color:#36acaa">required</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">True, </span><span class="token assign-left variable" style="color:#36acaa">default</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">argparse.SUPPRESS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _parser.add_argument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;--conda-env&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">dest</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;conda_env_path&quot;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">str, </span><span class="token assign-left variable" style="color:#36acaa">required</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">True, </span><span class="token assign-left variable" style="color:#36acaa">default</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">argparse.SUPPRESS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _parsed_args </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> vars</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_parser.parse_args</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _outputs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> upload_sklearn_model_to_mlflow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">**_parsed_args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      image: python:3.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    inputs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      parameters:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: model_name</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      artifacts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: train-from-csv-conda_env, path: /tmp/inputs/conda_env/data</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: train-from-csv-input_example, path: /tmp/inputs/input_example/data</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: train-from-csv-model, path: /tmp/inputs/model/data</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: train-from-csv-signature, path: /tmp/inputs/signature/data</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pipelines.kubeflow.org/kfp_sdk_version: </span><span class="token number" style="color:#36acaa">1.8</span><span class="token plain">.10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pipelines.kubeflow.org/pipeline-sdk-type: kfp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pipelines.kubeflow.org/enable_caching: </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      annotations: </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">pipelines.kubeflow.org/component_spec: </span><span class="token string" style="color:#e3116c">&#x27;{&quot;implementation&quot;: {&quot;container&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          {&quot;args&quot;: [&quot;--model-name&quot;, {&quot;inputValue&quot;: &quot;model_name&quot;}, &quot;--model&quot;, {&quot;inputPath&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          &quot;model&quot;}, &quot;--input-example&quot;, {&quot;inputPath&quot;: &quot;input_example&quot;}, &quot;--signature&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          {&quot;inputPath&quot;: &quot;signature&quot;}, &quot;--conda-env&quot;, {&quot;inputPath&quot;: &quot;conda_env&quot;}],</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          &quot;command&quot;: [&quot;sh&quot;, &quot;-c&quot;, &quot;(PIP_DISABLE_PIP_VERSION_CHECK=1 python3 -m pip</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          install --quiet --no-warn-script-location &#x27;</span><span class="token plain">&#x27;dill</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">pandas</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">scikit-learn</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">mlflow</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">boto3</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">PIP_DISABLE_PIP_VERSION_CHECK</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> python3 -m pip </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          --quiet --no-warn-script-location </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">dill</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">pandas</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">scikit-learn</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">mlflow</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">boto3</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"> --user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token variable" style="color:#36acaa">$0</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot; </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token variable" style="color:#36acaa">$@</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token string" style="color:#e3116c">&quot;, &quot;</span><span class="token function" style="color:#d73a49">sh</span><span class="token string" style="color:#e3116c">&quot;, &quot;</span><span class="token plain">-ec</span><span class="token string" style="color:#e3116c">&quot;, &quot;</span><span class="token assign-left variable" style="color:#36acaa">program_path</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">mktemp</span><span class="token variable" style="color:#36acaa">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">nprintf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;%s</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot; </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token variable" style="color:#36acaa">$0</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot; </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token variable" style="color:#36acaa">$program_path</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">npython3 -u </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token variable" style="color:#36acaa">$program_path</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot; </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token variable" style="color:#36acaa">$@</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token string" style="color:#e3116c">&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          &quot;</span><span class="token plain">def upload_sklearn_model_to_mlflow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    model_name,</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    model_path,</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    input_example_path,</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    signature_path,</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    conda_env_path,</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          os</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> dill</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    from mlflow.sklearn </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> save_model</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    from</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          mlflow.tracking.client </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> MlflowClient</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    os.environ</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;MLFLOW_S3_ENDPOINT_URL</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;http://minio-service.kubeflow.svc:9000</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    os.environ</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;AWS_ACCESS_KEY_ID</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;minio</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    os.environ</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;AWS_SECRET_ACCESS_KEY</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;minio123</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> MlflowClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;http://mlflow-server-service.mlflow-system.svc:5000</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model_path, </span><span class="token assign-left variable" style="color:#36acaa">mode</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;rb</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> as file_reader:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n        clf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dill.load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_reader</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">input_example_path, </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;rb</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> as file_reader:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n        input_example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dill.load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_reader</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    with open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signature_path, </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;rb</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> as file_reader:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n        signature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dill.load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_reader</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    with open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conda_env_path, </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;rb</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> as file_reader:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n        conda_env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dill.load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">file_reader</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    save_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n        </span><span class="token assign-left variable" style="color:#36acaa">sk_model</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">clf,</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n        </span><span class="token assign-left variable" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">model_name,</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n        </span><span class="token assign-left variable" style="color:#36acaa">serialization_format</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;cloudpickle</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;,</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n        </span><span class="token assign-left variable" style="color:#36acaa">conda_env</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">conda_env,</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n        </span><span class="token assign-left variable" style="color:#36acaa">signature</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">signature,</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n        </span><span class="token assign-left variable" style="color:#36acaa">input_example</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">input_example,</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client.create_run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">experiment_id</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;0</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n    client.log_artifact</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">run.info.run_id,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          model_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">nimport argparse</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">n_parser </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> argparse.ArgumentParser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prog</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">Upload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          sklearn model to mlflow</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">, </span><span class="token assign-left variable" style="color:#36acaa">description</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain">&#x27;</span><span class="token string" style="color:#e3116c">&#x27;)\n_parser.add_argument(\&quot;--model-name\&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          dest=\&quot;model_name\&quot;, type=str, required=True, default=argparse.SUPPRESS)\n_parser.add_argument(\&quot;--model\&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          dest=\&quot;model_path\&quot;, type=str, required=True, default=argparse.SUPPRESS)\n_parser.add_argument(\&quot;--input-example\&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          dest=\&quot;input_example_path\&quot;, type=str, required=True, default=argparse.SUPPRESS)\n_parser.add_argument(\&quot;--signature\&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          dest=\&quot;signature_path\&quot;, type=str, required=True, default=argparse.SUPPRESS)\n_parser.add_argument(\&quot;--conda-env\&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          dest=\&quot;conda_env_path\&quot;, type=str, required=True, default=argparse.SUPPRESS)\n_parsed_args</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          = vars(_parser.parse_args())\n\n_outputs = upload_sklearn_model_to_mlflow(**_parsed_args)\n&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          &quot;image&quot;: &quot;python:3.7&quot;}}, &quot;inputs&quot;: [{&quot;name&quot;: &quot;model_name&quot;, &quot;type&quot;: &quot;String&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          {&quot;name&quot;: &quot;model&quot;, &quot;type&quot;: &quot;dill&quot;}, {&quot;name&quot;: &quot;input_example&quot;, &quot;type&quot;: &quot;dill&quot;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          {&quot;name&quot;: &quot;signature&quot;, &quot;type&quot;: &quot;dill&quot;}, {&quot;name&quot;: &quot;conda_env&quot;, &quot;type&quot;: &quot;dill&quot;}],</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">          &quot;name&quot;: &quot;Upload sklearn model to mlflow&quot;}&#x27;</span><span class="token plain">, pipelines.kubeflow.org/component_ref: </span><span class="token string" style="color:#e3116c">&#x27;{}&#x27;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pipelines.kubeflow.org/arguments.parameters: </span><span class="token string" style="color:#e3116c">&#x27;{&quot;model_name&quot;: &quot;{{inputs.parameters.model_name}}&quot;}&#x27;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  arguments:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameters:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: kernel</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name: model_name</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  serviceAccountName: pipeline-runner</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details><p></p><p>실행후 생성된 mlflow_pipeline.yaml 파일을 파이프라인 업로드한 후, 실행하여 run 의 결과를 확인합니다.</p><p><img loading="lazy" alt="mlflow-svc-0" src="/assets/images/mlflow-svc-0-ab6c5d7f00bf643c36d236155dc5eb9c.png" width="3408" height="2156" class="img_ev3q"></p><p>mlflow service를 포트포워딩해서 MLflow ui에 접속합니다.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl port-forward svc/mlflow-server-service -n mlflow-system </span><span class="token number" style="color:#36acaa">5000</span><span class="token plain">:5000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="클립보드에 코드 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>웹 브라우저를 열어 localhost:5000으로 접속하면, 다음과 같이 run이 생성된 것을 확인할 수 있습니다.</p><p><img loading="lazy" alt="mlflow-svc-1" src="/assets/images/mlflow-svc-1-7723b8f92fb8cea2ff99b8f4639ff0c6.png" width="3360" height="2100" class="img_ev3q"></p><p>run 을 클릭해서 확인하면 학습한 모델 파일이 있는 것을 확인할 수 있습니다.</p><p><img loading="lazy" alt="mlflow-svc-2" src="/assets/images/mlflow-svc-2-8b696bd65a922f949877102bbfdafc42.png" width="3360" height="2100" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/mlops-for-all/mlops-for-all.github.io/tree/main/docs/kubeflow/advanced-mlflow.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>페이지 편집</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">최종 수정: <!-- --> <b><time datetime="2023-07-10T12:40:55.000Z">2023년 7월 10일</time></b>에<!-- --> <b>Jongseob Jeon</b>가</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="문서 페이지"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/kubeflow/advanced-run"><div class="pagination-nav__sublabel">이전</div><div class="pagination-nav__label">11. Pipeline - Run Result</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/kubeflow/how-to-debug"><div class="pagination-nav__sublabel">다음</div><div class="pagination-nav__label">13. Component - Debugging</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#mlflow-component" class="table-of-contents__link toc-highlight">MLFlow Component</a></li><li><a href="#mlflow-in-local" class="table-of-contents__link toc-highlight">MLFlow in Local</a><ul><li><a href="#1-모델-학습" class="table-of-contents__link toc-highlight">1. 모델 학습</a></li><li><a href="#2-mlflow-infos" class="table-of-contents__link toc-highlight">2. MLFLow Infos</a></li><li><a href="#3-save-mlflow-infos" class="table-of-contents__link toc-highlight">3. Save MLFLow Infos</a></li></ul></li><li><a href="#mlflow-on-server" class="table-of-contents__link toc-highlight">MLFlow on Server</a></li><li><a href="#mlflow-component-1" class="table-of-contents__link toc-highlight">MLFlow Component</a></li><li><a href="#mlflow-pipeline" class="table-of-contents__link toc-highlight">MLFlow Pipeline</a><ul><li><a href="#data-component" class="table-of-contents__link toc-highlight">Data Component</a></li><li><a href="#pipeline" class="table-of-contents__link toc-highlight">Pipeline</a></li><li><a href="#run" class="table-of-contents__link toc-highlight">Run</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://makinarocks.ai" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/makinarocks.png" alt="MakinaRocks" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/img/makinarocks.png" alt="MakinaRocks" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright">Copyright © 2023 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.1adf9bde.js"></script>
<script src="/assets/js/main.a672047f.js"></script>
</body>
</html>